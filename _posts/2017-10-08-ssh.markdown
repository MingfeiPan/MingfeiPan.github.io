---
layout: post
title: ssh 做端口转发的一些实践
category: ssh
tag : ssh
---

### ssh  

今天在家里折腾了一下系统, 给台机装了linux, 但是很尴尬, 联通不知道什么时候把公网ip给收了, 所以顺便折腾了ssh -R 转发(比ngrok什么的方便多了)

要借助一个可连接的vps, 这里我用了一个美西的搬瓦工服务器(好吧, 转发之后ssh确实慢了一些)   

下面具体写一下过程 假设这个没公网的机器为a, vps为b, 实际上就是在a建立一个到b的通道 使b监听自己某个端口的请求并转发到a

首先在vps b上sshd_config文件开启 GatewayPorts, 使b可以监听回环地址以外的地址, 这样其他服务器才能访问到这个端口, a建立和b的反向端口转发, 让b在0.0.0.0上监听7002端口, 访问这个端口的数据转发到a的22端口  

<img src="/img/in-post/gatewayports.png">  

如上图配置项:   


在a端执行:  
`ssh -CqTfnN -R  0.0.0.0:7002:{ipa}:22   {ipb} -p {sshportb}`  

 之后可以观察b的7002端口, 应该是已经在监听请求了, 这样我们可以用任何一个能访问到b的服务器, 只要去ssh b的7002端口, 就可以访问到a, 免除没有公网ip无法ssh的问题。
 



  
